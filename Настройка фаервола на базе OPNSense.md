## Первичная настройка IP адресации

1. В большинстве случаев внутренний интерфейс OPNsense уже настроен на адрес 192.168.1.1/24. В этом случае для начала настройки необходимо подключиться клиентского ПК, находящегося в той же сети.    

    Адрес может быть получен автоматически или настроен вручную, к примеру 192.168.1.10/24 на любой ОС с графическим интерфейсом и браузером.    

    Вход в открывшееся меню с логином и паролем по умолчанию:    
Логин: root    
Пароль: opnsense    

    **Внимание!!!**    
Если внутренний интерфейс сети не настроен, можно залогиниться в терминальный режим ОС OPNsense с тем же логином и паролем. После чего воспользоваться встроенным меню настройки роутера.    
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image2.png)    

    На скриншоте видно, что за настройку интерфейсов и их IP адресов отвечает пункт (2). При выборе необходимого пункта меню, на экран будет выводиться следующее меню, для последовательной настройки необходимых параметров. 

    Иногда требуется произвести назначение интерфейсов на роутере воспользовавшись пунктом (1).    

    Более подробно о таком типе настройке роутера можно поискать в Интернет.


2. После того, как вы залогинились в веб-оболочку настройки OPNsense вы можете производить его более тонкую настройку.    

    Рекомендуем первым делам создать пользователя с максимальными привелегиями (в Windows системах сказали бы, с правами Администратора). Это необходимо, чтобы не входить каждый раз привилегированным суперпользователем root и не подвергнуть систему опасности взлома.    
**Документация:** https://docs.opnsense.org/manual/how-tos/user-local.html


3. Если вам удобнее производить настройки, пользуясь меню на родном языке, в некоторых версиях OPNsense есть русская локализация. Переключить можно раздел “System” (Система), меню “Settings” (Настройки), подменю “General” (Общие настройки). И найти переключение языков оболочки.    
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image8.png)    ![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image1.png)    
Как видим в этом же меню меняется временная зона в которой настраивается ваше оборудование и не только.    
Внимательно изучите это меню общих настроек.

4. Проверка и настройка интерфейсов после подключения к веб-оболочке происходит в меню “Interfaces” (Интерфейсы). В самом верху перечислены все определенные в системе логические интерфейсы. Входя в каждый из них, мы можем задать отдельный параметры, к примеру задать статический адрес и маску сети или выбрать получение адреса динамически.    
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image3.png)    

5. Если у вас на роутере интерфейсов больше чем два (LAN и WAN), часто бывает необходимо сделать привязку физического интерфейса и логического. Иногда создать новый логический интерфейс из меню “Assignments” (Задать/Связать).
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image7.png)    
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image4.png)    

    После чего вновь созданный (привязанный) интерфейс появится вначале списка логических интерфейсов и сможете его настроить.    

6. По умолчанию OPNsense обычно настроен на работу  NAT по умолчанию, где LAN интерфейс внутренней сети, а WAN интерфейс с выходом в Интернет.    

    Часто требуется  более тонкая настройка правил, особенно если планируется внутри локальной сети поднимать сервер доступный из Интернет.

    Рекомендуется зайти в настройки “Firewall” (Брэндмауер), затем в меню “Outboand” (Исходящие соединения) и выбрать вариант работы:    
**Hybrid outbound NAT generation**
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image4.png)        

    Это даст возможность, как использовать преднастроенные правила, так и настроить свои собственные.


7. Чаще всего требуется настроить проброс портов с внешнего интерфейса WAN на внутренний IP адрес, например для удаленного управления сервером по протоколу SSH.    

    Переадресация (проброс) портов настраивается в меню “Port Forward” (Переадресация портов).    
Пример: https://getlabsdone.com/how-to-configure-opnsense-port-forwarding/    

    Всё понятно интуитивно, для указания “Sources” (Источника) выбираем интерфейс с которого получаем запрос на соединение (для внешних запросов обычно это WAN), далее протокол (если не знаем какой у нас, оставляем TCP/UDP).    

    Можно указать с какого именно адреса или сети  будет идти запрос или разрешить любой.    

    Можно выбрать диапазон портов, выбрать обращение на любой порт или указать конкретный, например 2222 вместо стандартно 22 для SSH.    

    После указать назначение переадресации или “Destination” внутри вашей локальной сети. Это может быть внутренний IP адрес или заранее созданный “Aliases” (Псевдоним) компьютера, который создается в меню “Aliases” раздела “Firewall”.    

    Далее указывается порт или диапазон перенаправления, иногда достаточно выбрать стандартную службу и порт будет выбран автоматически. Так для SSH порт по умолчанию 22. Не забудьте сохранить правило.    

    Работать будет так, при запросе со стороны интернет соединения SSH (ssh -p2222 <IP адрес интерфейса WAN> оно будет перенаправленно на указанный вами адрес компьютера, но на стандартный для SSH порт 22.    
![Alt-текст](https://github.com/WSRGUVD/OPNsense/blob/main/imges/image5.png)    


    Более подробно возможные настройки OPNsense мы рассмотрим в других уроках или вы можете найти всю информацию. в интернет, воспользовавшись приведенными ниже источниками.    

**Используемые источники:**    
<a href="https://www.google.com/url?q=https://techexpert.tips/ru/opnsense-ru/%25D1%2583%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0-opnsense-%25D1%2588%25D0%25B0%25D0%25B3-%25D0%25B7%25D0%25B0-%25D1%2588%25D0%25B0%25D0%25B3%25D0%25BE%25D0%25BC/&sa=D&source=editors&ust=1639337909577000&usg=AOvVaw29XSyDXWUf3sek3TdgdkFC">Установка OPNsense - Шаг за шагом</a>    
<a href="https://www.google.com/url?q=https://itarticle.ru/console-setup-pfsense-opnsense/&sa=D&source=editors&ust=1639337909578000&usg=AOvVaw1FdTqgrV76aBBp3Of4am7X">Первичная настройка в консоли pfsense/opnsense</a>    
<a href="https://www.google.com/url?q=https://osbsd.com/forwarding-the-port-to-opnsense.html&sa=D&source=editors&ust=1639337909578000&usg=AOvVaw2ZRCacs4_JBdmmdWBq3pWW">Пробрасываем порт на OPNSense</a>    
<a href="https://www.google.com/url?q=https://docs.opnsense.org/manual/nat.html&sa=D&source=editors&ust=1639337909578000&usg=AOvVaw0wJ8TujMmXj0Xvfh8Cd49c">Network Address Translation - OPNsense's documentation! (официальный сайт)</a>    
<a href="https://www.google.com/url?q=https://cgartworld.com/ru/texts/9549-how-to-install-and-configure-basic-opnsense-firewall&sa=D&source=editors&ust=1639337909579000&usg=AOvVaw0acJhm_-bASk1HGwSqG0rO">Как установить и настроить базовый брандмауэр OpnSense</a>    

