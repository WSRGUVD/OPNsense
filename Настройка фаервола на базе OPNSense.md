## Первичная настройка IP адресации

В большинстве случаев внутренний интерфейс OPNsense уже настроен на адрес 192.168.1.1/24. В этом случае для начала настройки необходимо подключиться клиентского ПК, находящегося в той же сети. 
![Alt-текст](https://github.com/WSRGUVD/debian/blob/main/images/01/image3.png)
Адрес может быть получен автоматически или настроен вручную, к примеру 192.168.1.10/24 на любой ОС с графическим интерфейсом и браузером. 

Вход в открывшееся меню с логином и паролем по умолчанию:
Логин: root
Пароль: opnsense

Внимание!!!
Если внутренний интерфейс сети не настроен, можно залогиниться в терминальный режим ОС OPNsense с тем же логином и паролем. После чего воспользоваться встроенным меню настройки роутера.


На скриншоте видно, что за настройку интерфейсов и их IP адресов отвечает пункт (2). При выборе необходимого пункта меню, на экран будет выводиться следующее меню, для последовательной настройки необходимых параметров. 

Иногда требуется произвести назначение интерфейсов на роутере воспользовавшись пунктом (1).

Более подробно о таком типе настройке роутера можно поискать в Интернет.


После того, как вы залогинились в веб-оболочку настройки OPNsense вы можете производить его более тонкую настройку.

Рекомендуем первым делам создать пользователя с максимальными привелегиями (в Windows системах сказали бы, с правами Администратора). Это необходимо, чтобы не входить каждый раз привилегированным суперпользователем root и не подвергнуть систему опасности взлома.
Документация: https://docs.opnsense.org/manual/how-tos/user-local.html





Если вам удобнее производить настройки, пользуясь меню на родном языке, в некоторых версиях OPNsense есть русская локализация. Переключить можно раздел “System” (Система), меню “Settings” (Настройки), подменю “General” (Общие настройки). И найти переключение языков оболочки.


Как видим в этом же меню меняется временная зона в которой настраивается ваше оборудование и не только. Внимательно изучите это меню общих настроек.

Проверка и настройка интерфейсов после подключения к веб-оболочке происходит в меню “Interfaces” (Интерфейсы). В самом верху перечислены все определенные в системе логические интерфейсы. Входя в каждый из них, мы можем задать отдельный параметры, к примеру задать статический адрес и маску сети или выбрать получение адреса динамически.


Если у вас на роутере интерфейсов больше чем два (LAN и WAN), часто бывает необходимо сделать привязку физического интерфейса и логического. Иногда создать новый логический интерфейс из меню “Assignments” (Задать/Связать).


После чего вновь созданный (привязанный) интерфейс появится вначале списка логических интерфейсов и сможете его настроить.
По умолчанию OPNsense обычно настроен на работу  NAT по умолчанию, где LAN интерфейс внутренней сети, а WAN интерфейс с выходом в Интернет.

Часто требуется  более тонкая настройка правил, особенно если планируется внутри локальной сети поднимать сервер доступный из Интернет.

Рекомендуется зайти в настройки “Firewall” (Брэндмауер), затем в меню “Outboand” (Исходящие соединения) и выбрать вариант работы:
Hybrid outbound NAT generation

Это даст возможность, как использовать преднастроенные правила, так и настроить свои собственные.


Чаще всего требуется настроить проброс портов с внешнего интерфейса WAN на внутренний IP адрес, например для удаленного управления сервером по протоколу SSH.

Переадресация (проброс) портов настраивается в меню “Port Forward” (Переадресация портов).
Пример: https://getlabsdone.com/how-to-configure-opnsense-port-forwarding/

Всё понятно интуитивно, для указания “Sources” (Источника) выбираем интерфейс с которого получаем запрос на соединение (для внешних запросов обычно это WAN), далее протокол (если не знаем какой у нас, оставляем TCP/UDP). 

Можно указать с какого именно адреса или сети  будет идти запрос или разрешить любой.

Можно выбрать диапазон портов, выбрать обращение на любой порт или указать конкретный, например 2222 вместо стандартно 22 для SSH.

После указать назначение переадресации или “Destination” внутри вашей локальной сети. Это может быть внутренний IP адрес или заранее созданный “Aliases” (Псевдоним) компьютера, который создается в меню “Aliases” раздела “Firewall”.

Далее указывается порт или диапазон перенаправления, иногда достаточно выбрать стандартную службу и порт будет выбран автоматически. Так для SSH порт по умолчанию 22. Не забудьте сохранить правило.

Работать будет так, при запросе со стороны интернет соединения SSH (ssh -p2222 <IP адрес интерфейса WAN> оно будет перенаправленно на указанный вами адрес компьютера, но на стандартный для SSH порт 22.



Более подробно возможные настройки OPNsense мы рассмотрим в других уроках или вы можете найти всю информацию. в интернет, воспользовавшись приведенными ниже источниками.

Используемые источники:
Установка OPNsense - Шаг за шагом
Первичная настройка в консоли pfsense/opnsense
Пробрасываем порт на OPNSense
Network Address Translation - OPNsense's documentation! (официальный сайт)
Как установить и настроить базовый брандмауэр OpnSense

